Agnostic to Petri Nets.

--------------------------------- MODULE Helpers -----------------------------------

EXTENDS Integers, Sequences

\**********************************************************************************
\* Convert a set to a sequence.
\**********************************************************************************
SetToSeq(s) == LET
    RECURSIVE Helper(_)
    Helper(s_) ==
        IF s_ = {}
        THEN <<>>
        ELSE
            LET x == CHOOSE x \in s_: TRUE
            IN <<x>> \o Helper(s_ \ {x})
IN Helper(s)

\**********************************************************************************
\* Sum a sequence.
\**********************************************************************************
SumSeq(s) == LET
    RECURSIVE Helper(_)
    Helper(s_) ==
        IF s_ = <<>>
        THEN 0
        ELSE Head(s_) + Helper(Tail(s_))
IN Helper(s)

\**********************************************************************************
\* Sum the counts of a Bag.
\**********************************************************************************
BagSum(B) == LET
    ks == SetToSeq(DOMAIN B)
    vs == [i \in 1..Len(ks) |-> B[ks[i]]]
IN SumSeq(vs)

===================================================================================
